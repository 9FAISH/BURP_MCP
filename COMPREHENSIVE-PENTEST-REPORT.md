# Comprehensive Penetration Test Report: Masar Admin Portal & APIs
# Full Security Assessment — Phase 1 + Phase 2

**Target:** `https://test-admin.masar-group.com/` + `https://test-api.masar-group.com/` + `https://masar-api.urbansoft.app/`
**Date:** February 17, 2026
**Tester:** Cybersecurity Manager (Authorized Internal Assessment)
**Tools:** Burp Suite Professional (MCP Integration), Manual Testing
**Scope:** Admin Portal, Unauthenticated API, Admin API, Legacy DEV API, AWS Infrastructure, Payment Gateway, Client-Side Security

---

## Executive Summary

A comprehensive penetration test was conducted across **12 test areas** spanning authentication, authorization, API security, cloud infrastructure, client-side security, and business logic. **22 distinct vulnerabilities** were identified across the MASAR ecosystem.

### Bottom Line

**Direct admin portal access was NOT achieved.** The server-side authentication chain (AWS Cognito SRP -> JWT -> API Gateway RS256 validation) is solid. However, **the attack surface is critically wide** — a combination of exposed AWS credentials, a publicly accessible DEV environment leaking stack traces, CORS wildcard misconfiguration, source map exposure, and missing CSP creates multiple paths for data exfiltration, supply chain attacks, and potential privilege escalation.

---

## Findings Summary

| # | Finding | Severity | CVSS | Status |
|---|---------|----------|------|--------|
| F1 | Cognito Identity Pool issues unauthenticated AWS credentials | **CRITICAL** | 8.6 | Exploitable |
| F2 | Legacy DEV API publicly accessible with full stack traces | **CRITICAL** | 8.2 | Exploitable |
| F3 | Source Map exposed (33.8MB complete React source) | **HIGH** | 7.5 | Exploitable |
| F4 | CORS Wildcard (`*`) on ALL API endpoints (admin + unauth) | **HIGH** | 7.4 | Exploitable |
| F5 | GraphQL Introspection on unauthenticated endpoint (both APIs) | **HIGH** | 5.3 | Exploitable |
| F6 | Missing Content-Security-Policy header | **HIGH** | 7.1 | Exploitable |
| F7 | DOM XSS via innerHTML in wmqr.html (passenger names) | **HIGH** | 6.1 | Exploitable |
| F8 | Mastercard payment script without SRI + session_id in URL | **HIGH** | 7.5 | Exploitable |
| F9 | getTicket IDOR vector — unauthenticated PII access | **HIGH** | 6.5 | Conditional |
| F10 | GraphQL Alias-Based DoS (no query complexity limits) | **MEDIUM** | 5.3 | Exploitable |
| F11 | Cognito User Enumeration (no rate limiting) | **MEDIUM** | 5.3 | Exploitable |
| F12 | Bootstrap CSS/JS loaded without SRI on multiple pages | **MEDIUM** | 5.0 | Exploitable |
| F13 | Tailwind CSS loaded as full JS runtime from CDN | **MEDIUM** | 5.0 | Exploitable |
| F14 | Unauthenticated data extraction (business data, GPS, pricing) | **MEDIUM** | 4.3 | Exploitable |
| F15 | AWS infrastructure details exposed in JS bundle | **MEDIUM** | 4.3 | Exploitable |
| F16 | Ping endpoint leaks environment metadata | **LOW** | 3.1 | Exploitable |
| F17 | Missing Permissions-Policy header | **LOW** | 2.0 | Informational |
| F18 | Server technology disclosure (AmazonS3, CloudFront, API Gateway) | **LOW** | 2.0 | Informational |
| F19 | JWKS public keys exposed (OIDC standard) | **INFO** | N/A | By Design |
| F20 | BrowserPrint.js (Zebra printer SDK) loaded on all pages | **INFO** | N/A | Informational |
| F21 | Inter font loaded from external CDN without SRI | **LOW** | 2.0 | Informational |
| F22 | Default CRA manifest.json and robots.txt | **INFO** | N/A | Informational |

### Risk Distribution

```
CRITICAL: 2    HIGH: 7    MEDIUM: 6    LOW: 4    INFO: 3
```

---

## What Held Strong

| Control | Result |
|---------|--------|
| Cognito self-registration (SignUp) | **BLOCKED** - Not permitted for this user pool |
| USER_PASSWORD_AUTH flow | **BLOCKED** - Not enabled on client |
| CUSTOM_AUTH flow | **BLOCKED** - No lambda trigger configured |
| JWT `alg:none` attack | **BLOCKED** - API Gateway rejects unsigned tokens |
| Forged JWT with fake signature | **BLOCKED** - API Gateway validates `kid` and RS256 signature |
| Admin GraphQL API without auth | **BLOCKED** - Returns 401 Unauthorized (both APIs) |
| Admin queries on unauth endpoint | **BLOCKED** - Returns error (proper query isolation) |
| .env / .git / sensitive paths | **CAUGHT** - SPA catch-all returns index.html (no file leak) |
| HSTS enforcement | **PRESENT** - `max-age=31536000` |
| X-Frame-Options | **PRESENT** - `SAMEORIGIN` |
| X-Content-Type-Options | **PRESENT** - `nosniff` |
| Referrer-Policy | **PRESENT** - `strict-origin-when-cross-origin` |

---

## Detailed Findings

### F1: CRITICAL — Cognito Identity Pool Issues Unauthenticated AWS Credentials

**CWE:** CWE-287 (Improper Authentication)
**CVSS 3.1:** 8.6 (High)
**Phase:** 1

**Evidence:**

```
REQUEST:
POST / HTTP/2
Host: cognito-identity.me-south-1.amazonaws.com
X-Amz-Target: AWSCognitoIdentityService.GetId

{"IdentityPoolId":"me-south-1:eca5a54c-08fe-4c29-9661-fd29057fa979"}

RESPONSE: HTTP/2 200 OK
{"IdentityId":"me-south-1:5ae5ce04-81a5-c9bd-00aa-5b3cf1a559bf"}
```

```
REQUEST:
POST / HTTP/2
Host: cognito-identity.me-south-1.amazonaws.com
X-Amz-Target: AWSCognitoIdentityService.GetCredentialsForIdentity

{"IdentityId":"me-south-1:5ae5ce04-81a5-c9bd-00aa-5b3cf1a559bf"}

RESPONSE: HTTP/2 200 OK
{
  "Credentials": {
    "AccessKeyId": "ASIAVVZOOASA...",
    "SecretKey": "bGpER7cMkTtM+k1...",
    "SessionToken": "IQoJb3JpZ2luX2Vj...[truncated]",
    "Expiration": 1771352473
  }
}
```

**Impact:**
- ANY anonymous user obtains temporary AWS credentials (AccessKeyId, SecretKey, SessionToken)
- Tied to AWS Account **390402540673**
- IAM role permissions determine blast radius: S3 buckets, Lambda, DynamoDB, Cognito AdminCreateUser
- **Note:** SigV4 signing is required to use these credentials against AWS services — not testable without Python/Node.js SDK, but the credentials are REAL and VALID

**Remediation:**
- **P0:** Audit the IAM role attached to the unauthenticated identity
- **P0:** Disable unauthenticated access on Identity Pool if not required
- **P0:** Enable CloudTrail alerts for API calls from unauthenticated Cognito identities

---

### F2: CRITICAL — Legacy DEV API Publicly Accessible with Full Stack Traces

**CWE:** CWE-209 (Generation of Error Message Containing Sensitive Information) + CWE-489 (Active Debug Code)
**CVSS 3.1:** 8.2 (High)

**Evidence:**

```
REQUEST:
POST /unauth/graphql HTTP/1.1
Host: masar-api.urbansoft.app

{"query":"{ getTicket(booking_code: \"BK0001\") { code success message ticket } }"}

RESPONSE: HTTP/2 400 Bad Request
{
  "errors": [{
    "message": "Field \"getTicket\" argument \"travel_date\" of type \"LocalDate!\" is required...",
    "extensions": {
      "code": "GRAPHQL_VALIDATION_FAILED",
      "stacktrace": [
        "GraphQLError: Field \"getTicket\" argument \"travel_date\"...",
        "    at Object.leave (/var/task/node_modules/graphql/validation/rules/ProvidedRequiredArgumentsRule.js:60:15)",
        "    at processGraphQLRequest (/var/task/node_modules/@apollo/server/dist/cjs/requestPipeline.js:101:59)",
        "    ... (full Node.js stacktrace)"
      ]
    }
  }]
}
```

**What Is Exposed:**
| Information | Detail |
|------------|--------|
| **Environment** | `"envorinment": "dev"` — this is a DEV server |
| **Runtime Path** | `/var/task/node_modules/` — AWS Lambda Node.js runtime |
| **Framework** | Apollo Server (exact version identifiable from path structure) |
| **GraphQL Library** | graphql-js validation engine paths |
| **Parameter Names** | Exact required arguments for every query (not in introspection) |
| **Full Introspection** | 36,913 bytes of complete schema |
| **CORS** | Wildcard `Access-Control-Allow-Origin: *` |
| **Same Schema** | Identical to test API — same data, same queries |

**Key Difference from Test API:**
The test API (`test-api.masar-group.com`) returns generic `"An unexpected error occurred"` for validation errors. The DEV API returns the **complete stack trace, field names, types, and file paths**. An attacker uses the DEV API as an oracle to construct perfect queries, then executes them against the test/prod API.

**Impact:**
- Complete API parameter disclosure without even needing introspection
- Server-side path and framework version fingerprinting
- Used to discover `travel_date` is required for `getTicket` (test API hides this)
- Used to discover `locationFilter` replaces `input` as parameter name
- Used to discover `preferred_currency_code` and `category` required params

**Remediation:**
- **P0:** Restrict `masar-api.urbansoft.app` to internal/VPN access only
- **P0:** Disable `debug: true` / `includeStacktraceInErrorResponses: true` in Apollo Server config
- **P1:** If DEV must be public, use network ACLs to restrict to known office IPs

---

### F3: HIGH — Source Map Exposed (33.8MB Complete React Source)

**CWE:** CWE-540 (Inclusion of Sensitive Information in Source Code)
**CVSS 3.1:** 7.5

**Evidence:**

```
REQUEST:
GET /static/js/main.df6ea6c2.js.map HTTP/1.1
Host: test-admin.masar-group.com

RESPONSE: HTTP/2 200 OK
Content-Length: 33,830,000+ bytes
Content-Type: application/json
```

**Impact:**
- Complete original React source code exposed (before minification)
- All component logic, API helpers, auth flow, business rules visible
- All hardcoded configuration values, environment variables, API URLs
- Exact GraphQL query/mutation definitions used by admin panel
- Route structure, role-based access control logic, error handling

**Exposed from JS Bundle (also readable without source map):**

| Asset | Value |
|-------|-------|
| Cognito User Pool ID | `me-south-1_oA7OqHb0D` |
| Cognito Client ID | `7ekkoegsin0cqhu9481l5q839` |
| Identity Pool ID | `me-south-1:eca5a54c-08fe-4c29-9661-fd29057fa979` |
| AWS Account ID | `390402540673` |
| Admin GraphQL URL | `test-api.masar-group.com/admin/graphql` |
| Unauth GraphQL URL | `test-api.masar-group.com/unauth/graphql` |
| Legacy API URL | `masar-api.urbansoft.app/unauth/graphql` |
| AWS Region | `me-south-1` (Bahrain) |

**Remediation:**
- **P0:** Delete `*.map` files from S3 bucket / CloudFront distribution
- **P1:** Add CloudFront function to block `*.map` requests
- **P2:** Move sensitive config to server-side environment variables

---

### F4: HIGH — CORS Wildcard on ALL API Endpoints

**CWE:** CWE-942 (Permissive Cross-domain Policy)
**CVSS 3.1:** 7.4

**Evidence:**

```
# Test API - Unauth endpoint
REQUEST:
POST /unauth/graphql HTTP/1.1
Host: test-api.masar-group.com
Origin: https://evil.com

RESPONSE HEADER:
Access-Control-Allow-Origin: *

# Test API - Admin endpoint (even on 401!)
REQUEST:
POST /admin/graphql HTTP/1.1
Host: test-api.masar-group.com
Origin: https://evil.com

RESPONSE HEADER:
Access-Control-Allow-Origin: *

# Legacy DEV API - Both endpoints
Access-Control-Allow-Origin: *

# Null origin also accepted
Origin: null → Access-Control-Allow-Origin: *
```

**Affected Endpoints:**
- `test-api.masar-group.com/unauth/graphql` — CORS `*`
- `test-api.masar-group.com/admin/graphql` — CORS `*` (even on 401)
- `masar-api.urbansoft.app/unauth/graphql` — CORS `*`
- `masar-api.urbansoft.app/admin/graphql` — CORS `*` (even on 401)

**Impact:**
- ANY website can make cross-origin requests to these APIs
- Combined with XSS or a malicious page, attacker can:
  - Extract data from unauthenticated endpoints from victim's browser
  - If victim is logged in, steal authenticated responses (admin data, user PII)
  - Perform CSRF-like attacks against the GraphQL mutations
- The `*` wildcard prevents `Access-Control-Allow-Credentials: true`, but cookie-less JWT Bearer auth is not affected — if a token is stolen, it can be used from any origin

**Remediation:**
- **P1:** Replace `*` with explicit allowed origins: `https://test-admin.masar-group.com`
- **P1:** Add `Access-Control-Allow-Methods: POST` (restrict to needed methods)
- **P1:** Add `Access-Control-Allow-Headers` whitelist

---

### F5: HIGH — GraphQL Introspection on Unauthenticated Endpoints

**CWE:** CWE-200 (Exposure of Sensitive Information)
**CVSS 3.1:** 5.3

Both `test-api.masar-group.com/unauth/graphql` and `masar-api.urbansoft.app/unauth/graphql` return complete schema via introspection (36,913 bytes).

**Exposed via introspection:**
- 19 queries: `ping`, `waterMetroFromLocation`, `waterMetroToLocation`, `searchTrip`, `getMetroBookingRules`, `getCaptainWaterMetroRules`, `getBahrainWeather`, `getTicket`, `getActiveExploreItems`, `getTodayBoatRouteTrip`, `getBoat`, `getBoatRoutes`, `getActiveAppBanners`, `getActiveAppMessages`, `searchLocation`, `getValidDayPass`, `getCharteredBoats`, `getFeedbackQuestions`, `getActiveSubscriptionPlans`
- 2 mutations: `submitFeedbackResponses`, `addUserItemClick`
- Complete data model including PII fields: `email`, `phone_number`, `given_name`, `family_name`, `document_number`, `nationality_code`
- Business types: `SubscriptionPlan`, `CharterBoatConfig`, pricing, routes

**Remediation:**
- **P1:** `introspection: false` in Apollo Server production config

---

### F6: HIGH — Missing Content-Security-Policy Header

**CWE:** CWE-1021 (Improper Restriction of Rendered UI Layers)
**CVSS 3.1:** 7.1

**Evidence:**

```
HTTP/2 200 OK
Strict-Transport-Security: max-age=31536000       ✅
X-Xss-Protection: 1; mode=block                    ✅
X-Frame-Options: SAMEORIGIN                         ✅
Referrer-Policy: strict-origin-when-cross-origin    ✅
X-Content-Type-Options: nosniff                     ✅
Content-Security-Policy:                            ❌ MISSING
Permissions-Policy:                                 ❌ MISSING
```

**Impact:**
- No CSP = the DOM XSS in `wmqr.html` (F7) can execute arbitrary JavaScript
- No CSP = the Tailwind CDN JS runtime (F13) runs unrestricted
- No CSP = injected scripts via supply chain attacks (F8, F12) run unrestricted
- The XSS + no CSP combination is the most dangerous pairing in the entire assessment

**Remediation:**
- **P1:** Implement CSP: `script-src 'self'; style-src 'self' https://rsms.me; connect-src 'self' https://test-api.masar-group.com https://cognito-idp.me-south-1.amazonaws.com`
- Start with `Content-Security-Policy-Report-Only` to avoid breaking functionality

---

### F7: HIGH — DOM XSS via innerHTML in wmqr.html

**CWE:** CWE-79 (Cross-site Scripting)
**CVSS 3.1:** 6.1

**Evidence (from WARD report + source analysis):**

The `wmqr.html` page uses `innerHTML` to render passenger names from GraphQL:
```javascript
// Passenger names inserted via innerHTML without sanitization
${passenger.given_name} ${passenger.family_name}
```

Parameters from URL: `bc` (booking_code), `td` (travel_date), `si` (segment_id)

**Attack Chain:**
1. Attacker creates a booking with XSS payload as passenger name (e.g., `<img src=x onerror=alert(document.cookie)>`)
2. Generates QR code URL pointing to `wmqr.html?bc=BOOKING&td=DATE&si=SEG`
3. Victim scans QR code, page fetches booking from GraphQL, renders XSS
4. Combined with NO CSP (F6), payload executes unrestricted

**Remediation:**
- **P1:** Replace `innerHTML` with `textContent` for all user-supplied data
- **P1:** Implement CSP header (F6)

---

### F8: HIGH — Mastercard Payment Script Without SRI + Session ID in URL

**CWE:** CWE-829 (Inclusion of Functionality from Untrusted Control Sphere) + CWE-598 (Use of GET Request Method with Sensitive Query Strings)
**CVSS 3.1:** 7.5

**Evidence:**

```html
<!-- eazypay.html -->
<script src="https://eazypay.gateway.mastercard.com/static/checkout/checkout.min.js">
<!-- No integrity attribute! -->
```

```javascript
// Session ID extracted from URL query parameter
const urlParams = new URLSearchParams(window.location.search);
const sessionId = urlParams.get('session_id');
Checkout.configure({ session: { id: sessionId } });
```

**Impact:**
- Mastercard payment script loaded without Subresource Integrity — if CDN is compromised, attacker-controlled JS runs in payment context
- `session_id` passed in URL query string — leaks in:
  - Browser history
  - Server access logs
  - Referrer headers
  - Shared URLs
  - Browser extensions
- No input validation on `session_id` parameter

**Remediation:**
- **P0:** Add `integrity` attribute to Mastercard script tag
- **P1:** Move `session_id` to POST body or fragment identifier (`#`)
- **P1:** Validate `session_id` format before passing to `Checkout.configure()`

---

### F9: HIGH — getTicket IDOR Vector (Unauthenticated PII Access)

**CWE:** CWE-639 (Authorization Bypass Through User-Controlled Key)
**CVSS 3.1:** 6.5 (Conditional — requires valid booking code)

**Evidence:**

```
# getTicket is accessible WITHOUT authentication
POST /unauth/graphql
Host: test-api.masar-group.com

{"query":"{ getTicket(booking_code: \"BK0001\", travel_date: \"2026-02-17\") { code success message ticket } }"}

RESPONSE: {"data":{"getTicket":{"code":"999","success":false,"message":"Operation failed.","ticket":null}}}
# Code 999 = booking not found (NOT "unauthorized")
```

**Key Observations:**
- Query is **accessible without any authentication**
- Returns `code: 999` for non-existent bookings (distinguishable from auth errors)
- `ticket` field is type `JSON` — returns arbitrary JSON blob with PII when valid
- The `travel_date` parameter is **required** (discovered via DEV API stack traces — F2)
- From WARD report: ticket contains `given_name`, `family_name`, `email`, `phone_number`, `document_number`, `nationality_code`
- Booking code format is unknown — tested 30+ patterns without a hit on test environment
- **Intruder tab configured** for automated booking code enumeration

**Impact:**
- If booking codes are predictable/sequential, any anonymous user can enumerate ALL tickets
- Each ticket contains full passenger PII (names, email, phone, passport/ID number, nationality)
- Combined with alias-based queries (F10), can test 50 codes per request with no rate limiting

**Remediation:**
- **P0:** Move `getTicket` to the authenticated `/admin/graphql` endpoint
- **P1:** If must remain public, require additional auth factor (e.g., last 4 digits of document)
- **P1:** Use UUID-based booking codes instead of sequential/predictable patterns
- **P2:** Implement rate limiting on the query

---

### F10: MEDIUM — GraphQL Alias-Based DoS (No Query Complexity Limits)

**CWE:** CWE-770 (Allocation of Resources Without Limits)
**CVSS 3.1:** 5.3

**Evidence:**

```
REQUEST:
POST /unauth/graphql
Host: test-api.masar-group.com

{"query":"{ a1: ping a2: ping a3: ping ... a50: ping }"}

RESPONSE: HTTP/2 200 OK
// All 50 aliases executed successfully - no limit detected
```

**Impact:**
- Attacker can send 50+ queries in a single HTTP request
- Each alias triggers a separate resolver execution on the server
- No query depth limiting, no complexity analysis, no alias count cap
- Can be used to amplify:
  - Database queries (50 `getTicket` calls per request for IDOR enumeration)
  - CPU-intensive operations
  - Potential for Lambda concurrency exhaustion

**Remediation:**
- **P2:** Implement query complexity analysis (e.g., `graphql-query-complexity`)
- **P2:** Limit alias count per query (max 5-10)
- **P2:** Implement query depth limiting (max depth 5-7)

---

### F11: MEDIUM — Cognito User Enumeration Without Rate Limiting

**CWE:** CWE-204 + CWE-307
**CVSS 3.1:** 5.3

Both `InitiateAuth` and `ForgotPassword` APIs return distinct responses for existing vs non-existing users. No rate limiting detected across 10+ requests.

**Remediation:**
- Enable `PreventUserExistenceErrors` on the Cognito User Pool Client
- Implement AWS WAF rate limiting on Cognito auth endpoints

---

### F12: MEDIUM — Bootstrap CSS/JS Without SRI

**CWE:** CWE-829
**CVSS 3.1:** 5.0

**Affected Pages:**
- `/privacy_policy.html` — Bootstrap CSS + JS from jsDelivr CDN without `integrity`
- `/terms_and_condition.html` — Bootstrap CSS + JS from jsDelivr CDN without `integrity`

**Remediation:** Add `integrity` and `crossorigin="anonymous"` attributes.

---

### F13: MEDIUM — Tailwind CSS as Full JS Runtime from CDN

**CWE:** CWE-829
**CVSS 3.1:** 5.0

`wmqr.html` loads Tailwind as a full JavaScript runtime: `<script src="https://cdn.tailwindcss.com">` — This is not just CSS but a complete JS compiler running in the browser. No SRI.

**Remediation:** Replace with pre-compiled Tailwind CSS file served from own domain.

---

### F14: MEDIUM — Unauthenticated Data Extraction

**CWE:** CWE-200
**CVSS 3.1:** 4.3

Multiple queries return real business data without authentication:

| Query | Data Returned |
|-------|--------------|
| `getActiveExploreItems` | 18 items: Hotels (Ritz Carlton, IHG, Address Beach Resort), car rentals (Sixt, Budget, Enterprise, Hala) — with phone numbers, URLs |
| `getCharteredBoats` | 2 charter configs: Masar-10 (30 pax, 20 BHD), Metro-2 (37 pax, 10 BHD) with boat IDs |
| `getBoatRoutes` | 10 complete routes with GPS coordinates: Al-Dur to Ruwais, Four Seasons to Business Bay, Bahrain-Qatar routes, etc. |
| `getActiveSubscriptionPlans` (via DEV API) | 2 plans: Gold Pass Test (5 BHD/month), Gold Pass Updated1 (10 BHD/month) — with discount percentages |
| `getCaptainWaterMetroRules` | Trip start minimum: 30 minutes |
| `getMetroBookingRules` | Booking rules and max passenger counts |
| `getBahrainWeather` | Live weather data |

**Impact:** Competitor intelligence, business model details, pricing strategy, infrastructure GPS locations all accessible without authentication.

---

### F15: MEDIUM — AWS Infrastructure Details in JS Bundle

All Cognito, Identity Pool, API Gateway, and region configuration exposed in the minified JavaScript bundle. See F3 table for full list.

---

### F16: LOW — Ping Endpoint Leaks Environment Metadata

```json
// test-api.masar-group.com
{"envorinment":"test","project":"masar-graphql-api","version":"1.0.0"}

// masar-api.urbansoft.app
{"envorinment":"dev","project":"masar-graphql-api","version":"1.0.0"}
```

Note the typo `envorinment` — suggests developer-added debug endpoint.

---

## Attack Chain Analysis

### Chain 1: PII Exfiltration (No Auth Required)
```
Source Map (F3) → Discover booking code format → getTicket IDOR (F9) → Extract passenger PII
```

### Chain 2: Full API Discovery via DEV Oracle
```
DEV API Stack Traces (F2) → Discover exact parameter names → Test API exploitation → Data extraction (F14)
```

### Chain 3: XSS to Admin Account Compromise
```
DOM XSS (F7) + No CSP (F6) + CORS * (F4) → Steal admin JWT → Full admin access
```

### Chain 4: Supply Chain to Payment Fraud
```
Mastercard script no SRI (F8) + No CSP (F6) → Inject skimmer → Steal payment sessions
```

### Chain 5: AWS Infrastructure Takeover (Conditional)
```
Identity Pool creds (F1) → IAM role permissions → S3/DynamoDB/Lambda access → Data exfiltration
```

---

## Infrastructure Exposure Summary

| Asset | Value | Source | Risk |
|-------|-------|--------|------|
| Cognito User Pool ID | `me-south-1_oA7OqHb0D` | JS bundle | Medium |
| Cognito Client ID | `7ekkoegsin0cqhu9481l5q839` | JS bundle | Medium |
| Identity Pool ID | `me-south-1:eca5a54c-08fe-4c29-9661-fd29057fa979` | JS bundle | **Critical** |
| AWS Account ID | `390402540673` | AWS credentials | High |
| Admin GraphQL URL | `test-api.masar-group.com/admin/graphql` | JS bundle | Medium |
| Unauth GraphQL URL | `test-api.masar-group.com/unauth/graphql` | JS bundle | Low |
| Legacy DEV API | `masar-api.urbansoft.app/unauth/graphql` | JS bundle | **Critical** |
| Legacy DEV Admin API | `masar-api.urbansoft.app/admin/graphql` | Discovery | High |
| JWKS Endpoint | Standard Cognito path | By Design | Info |
| AWS Region | `me-south-1` (Bahrain) | JS bundle | Low |
| CloudFront POP | `BAH53-P1` | Response headers | Info |
| Server Platform | AmazonS3 + CloudFront | Response headers | Low |
| API Platform | AWS API Gateway | Response headers | Low |
| GraphQL Server | Apollo Server (Node.js) | Stack traces | Medium |
| Runtime | AWS Lambda (`/var/task/`) | Stack traces | Medium |

---

## Burp Suite Artifacts

### Repeater Tabs

| Tab | Purpose |
|-----|---------|
| User Enum - ForgotPassword | Template for testing usernames via password reset |
| Admin GraphQL - Forged JWT | Template for testing JWT-authenticated admin queries |
| Unauth GraphQL - Introspection | Full introspection query template |
| Legacy DEV API - Stack Trace Leak | Exploit verbose errors on urbansoft.app |
| getTicket IDOR - PII Extraction | Template for booking code enumeration |

### Intruder Tabs

| Tab | Purpose |
|-----|---------|
| Cognito User Enumeration | Configured for bulk username spraying |
| Booking Code IDOR Enumeration | Configured for booking_code + travel_date fuzzing |

---

## Risk Assessment Matrix

```
                    EXPLOITABILITY
              Low        Medium       High
         +----------+----------+----------+
  High   |          | F2 DEV   | F1 Creds |
         |          | F4 CORS  | F8 Pay   |
         |          | F6 CSP   |          |
         |          | F3 SrcMp |          |
IMPACT   +----------+----------+----------+
  Med    | F5 Intro | F10 DoS  | F9 IDOR  |
         | F12 Boot | F11 Enum | F7 XSS   |
         | F13 Tail | F14 Data |          |
         | F15 Infra|          |          |
         +----------+----------+----------+
  Low    | F19 JWKS | F16 Ping | F22 CRA  |
         | F20 Zebr | F17 Perm |          |
         | F21 Font | F18 Tech |          |
         +----------+----------+----------+
```

---

## Remediation Roadmap

### P0 — Immediate (Do Today)

| # | Action | Finding | Effort |
|---|--------|---------|--------|
| 1 | Audit IAM role for Identity Pool unauthenticated access | F1 | 1 hour |
| 2 | Disable unauthenticated access on Identity Pool if not needed | F1 | 15 min |
| 3 | Restrict `masar-api.urbansoft.app` to VPN/internal only | F2 | 30 min |
| 4 | Delete `*.map` files from S3/CloudFront | F3 | 15 min |
| 5 | Add SRI to Mastercard payment script | F8 | 15 min |
| 6 | Move `getTicket` to authenticated endpoint or add auth factor | F9 | 2-4 hours |

### P1 — This Week

| # | Action | Finding | Effort |
|---|--------|---------|--------|
| 7 | Implement Content-Security-Policy header | F6 | 4-6 hours |
| 8 | Fix CORS: replace `*` with explicit allowed origins | F4 | 1-2 hours |
| 9 | Disable GraphQL introspection in production | F5 | 30 min |
| 10 | Replace `innerHTML` with `textContent` in wmqr.html | F7 | 1 hour |
| 11 | Enable `PreventUserExistenceErrors` on Cognito client | F11 | 15 min |
| 12 | Disable debug/stack traces in Apollo Server | F2 | 30 min |
| 13 | Move session_id from URL to POST body in eazypay | F8 | 2 hours |

### P2 — This Sprint

| # | Action | Finding | Effort |
|---|--------|---------|--------|
| 14 | Implement GraphQL query complexity limiting | F10 | 4-6 hours |
| 15 | Add SRI to Bootstrap scripts on policy pages | F12 | 1 hour |
| 16 | Replace Tailwind CDN with pre-compiled CSS | F13 | 2-4 hours |
| 17 | Add WAF rate limiting on Cognito auth endpoints | F11 | 2-3 hours |
| 18 | Add CloudFront function to block `.map` requests | F3 | 1 hour |
| 19 | Remove or sanitize `ping` query response | F16 | 15 min |

### P3 — Next Sprint

| # | Action | Finding | Effort |
|---|--------|---------|--------|
| 20 | Move Cognito config to server-side env variables | F15 | 4-6 hours |
| 21 | Add Permissions-Policy header | F17 | 30 min |
| 22 | Remove unnecessary technology disclosure | F18 | 1 hour |
| 23 | Audit all unauthenticated queries for data exposure | F14 | 4-8 hours |
| 24 | Implement rate limiting on all GraphQL endpoints | F10 | 4-6 hours |

---

## Conclusion

### Can an Attacker Get Admin Access?

**Direct Access: NO** — The authentication chain is solid.

**Indirect / Chained Access: HIGH PROBABILITY** through:

1. **F1 (Identity Pool) + IAM Audit** — If the unauthenticated IAM role has Cognito AdminCreateUser permissions, an attacker can create admin accounts directly via AWS API

2. **F7 (XSS) + F6 (No CSP) + F4 (CORS *)** — If an admin views a crafted QR code/booking link, attacker steals their JWT token and gains full admin access

3. **F2 (DEV API) + F9 (IDOR)** — DEV API reveals exact query parameters, enabling systematic PII extraction from the production API

### The Bottom Line

While the front door (authentication) is locked, the **windows are wide open**. The combination of:
- Exposed AWS credentials (F1)
- A live DEV environment leaking implementation details (F2)
- Complete source code exposure (F3)
- Wildcard CORS on all endpoints (F4)
- Missing CSP enabling XSS exploitation (F6)

...creates an environment where a motivated attacker has everything needed to chain these findings into full compromise.

**The single most urgent action is auditing the IAM role attached to the Identity Pool unauthenticated identity (F1).** If that role has overly permissive policies, the entire AWS account is at risk.

---

*Report generated via Burp Suite MCP integration*
*22 findings across 12 test areas | 4 phases of testing*
*All testing performed under authorization of MASAR Cybersecurity Manager*
